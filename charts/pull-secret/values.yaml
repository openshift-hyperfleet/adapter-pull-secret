# Pull Secret Adapter - Helm Values
#
# This adapter manages pull secrets in GCP Secret Manager for HyperFleet clusters.
# It uses the Adapter Framework to listen to PubSub messages and create jobs.
#
# For umbrella chart integration, set global.image.registry to override image registry.

# =============================================================================
# Global Overrides (for umbrella chart integration)
# =============================================================================
# When deployed as part of hyperfleet-chart umbrella, these can be set globally
global:
  image:
    registry: ""  # Override registry for all images (e.g., "quay.io/croche")

# =============================================================================
# Chart Identity
# =============================================================================
nameOverride: ""
fullnameOverride: ""

replicaCount: 1

# =============================================================================
# Image Configuration (Adapter Framework)
# =============================================================================
image:
  # Adapter Framework image
  registry: registry.ci.openshift.org
  repository: ci/hyperfleet-adapter
  tag: "latest"
  pullPolicy: Always

imagePullSecrets: []

# =============================================================================
# ServiceAccount Configuration
# =============================================================================
serviceAccount:
  # Create a ServiceAccount for the adapter framework deployment
  create: true
  # Name of the ServiceAccount (auto-generated if empty)
  name: ""
  # Annotations (optional, only needed for legacy GSA-based Workload Identity)
  # Modern approach uses direct principal binding - no annotation needed
  # Legacy: iam.gke.io/gcp-service-account: GSA_NAME@PROJECT_ID.iam.gserviceaccount.com
  annotations: {}

# =============================================================================
# RBAC Configuration
# =============================================================================
rbac:
  # Create RBAC resources (ClusterRole and ClusterRoleBinding)
  create: true
  # When enabled, grants minimal permissions needed for adapter:
  # - Read namespaces
  # - Manage ServiceAccounts, Roles, RoleBindings, Jobs
  # - Read pods and update Job status

# =============================================================================
# Logging Configuration
# =============================================================================
logging:
  level: info     # Options: debug, info, warn, error
  format: text    # Options: text, json
  output: stderr  # Options: stdout, stderr

# =============================================================================
# Broker Configuration (required for adapter to function)
# =============================================================================
broker:
  type: "googlepubsub"  # "googlepubsub" or "rabbitmq"

  # Google Pub/Sub (required when type: googlepubsub)
  googlepubsub:
    projectId: ""        # GCP project ID for Pub/Sub
    topic: ""            # Pub/Sub topic name
    subscription: ""     # Pub/Sub subscription name
    deadLetterTopic: ""  # Optional: Dead letter topic

  # RabbitMQ (required when type: rabbitmq)
  rabbitmq:
    url: ""  # amqp://user:pass@host:5672/

  subscriber:
    parallelism: 1

  # Raw YAML override (bypasses structured config above)
  yaml: ""

# =============================================================================
# HyperFleet API Configuration
# =============================================================================
hyperfleetApi:
  # Base URL for HyperFleet API (for status reporting)
  baseUrl: ""
  # API version
  version: "v1"

# =============================================================================
# Pull Secret Adapter Configuration
# =============================================================================
pullSecretAdapter:
  # Pull Secret adapter task image
  image:
    registry: quay.io/openshift-hyperfleet
    repository: pull-secret
    tag: "latest"

  # Status reporter sidecar image
  statusReporterImage: "registry.ci.openshift.org/ci/status-reporter:latest"

  # Shared result path for status reporter
  resultsPath: "/results/adapter-result.json"

  # Maximum time to wait for job completion (seconds)
  maxWaitTimeSeconds: "300"

  # Log level for job containers
  logLevel: "info"

# =============================================================================
# Platform-specific Scheduling
# =============================================================================
nodeSelector: {}
tolerations: []
affinity: {}

# =============================================================================
# Additional Environment Variables
# =============================================================================
env: []
  # - name: MY_VAR
  #   value: "my-value"
  # - name: MY_SECRET
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: key
