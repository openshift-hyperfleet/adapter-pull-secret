# HyperFleet Pull Secret Adapter Configuration
#
# This adapter creates a job to store pull secrets in GCP Secret Manager
# for HyperFleet clusters.
apiVersion: hyperfleet.redhat.com/v1alpha1
kind: AdapterConfig
metadata:
  name: pull-secret-adapter
  namespace: hyperfleet-system
  labels:
    hyperfleet.io/adapter-type: pull-secret
    hyperfleet.io/component: adapter
    hyperfleet.io/provider: gcp
spec:
  adapter:
    version: "0.1.0"
  # ============================================================================
  # HyperFleet API Configuration
  # ============================================================================
  hyperfleetApi:
    timeout: 2s
    retryAttempts: 3
  # ============================================================================
  # Kubernetes Configuration
  # ============================================================================
  kubernetes:
    apiVersion: "batch/v1"
  # ============================================================================
  # Parameters
  # ============================================================================
  params:
    - name: "hyperfleetApiBaseUrl"
      source: "env.HYPERFLEET_API_BASE_URL"
      type: "string"
      description: "Base URL for the HyperFleet API"
      required: true
    - name: "hyperfleetApiVersion"
      source: "env.HYPERFLEET_API_VERSION"
      type: "string"
      default: "v1"
      description: "API version to use"
    - name: "clusterId"
      source: "event.id"
      type: "string"
      description: "Unique identifier for the target cluster"
      required: true
    - name: "projectId"
      source: "event.projectId"
      type: "string"
      description: "GCP project ID where secrets will be stored"
      required: true
    - name: "statusReporterImage"
      source: "env.STATUS_REPORTER_IMAGE"
      type: "string"
      default: "registry.ci.openshift.org/ci/status-reporter:latest"
      description: "Container image for the status reporter"
    # Pull Secret Adapter configuration
    - name: "pullSecretImage"
      source: "env.PULL_SECRET_IMAGE"
      type: "string"
      default: "quay.io/openshift-hyperfleet/pull-secret:latest"
      description: "Pull secret adapter container image"
    - name: "pullSecretData"
      source: "event.pullSecretData"
      type: "string"
      description: "Pull secret JSON data to store"
      required: true
    - name: "secretName"
      source: "event.secretName"
      type: "string"
      description: "Secret name in GCP Secret Manager (optional, auto-generated if empty)"
    - name: "resultPath"
      source: "env.RESULTS_PATH"
      type: "string"
      default: "/results/adapter-result.json"
      description: "Adapter shared result path with status reporter"
    - name: "maxWaitTimeSeconds"
      source: "env.MAX_WAIT_TIME_SECONDS"
      type: "string"
      default: "300"
      description: "Maximum time to wait for job completion"
    - name: "logLevel"
      source: "env.LOG_LEVEL"
      type: "string"
      default: "info"
      description: "Log level for containers (debug, info, warn, error)"
    - name: "adapterTaskServiceAccount"
      source: "env.ADAPTER_TASK_SERVICE_ACCOUNT"
      type: "string"
      default: "pull-secret-adapter-task-sa"
      description: "Kubernetes ServiceAccount name for the adapter task"
    - name: "managedByResourceName"
      source: "env.MANAGED_BY_RESOURCE_NAME"
      type: "string"
      default: "pull-secret-adapter"
      description: "The value for hyperfleet.io/managed-by"
  # ============================================================================
  # Preconditions
  # ============================================================================
  preconditions: []
  # ============================================================================
  # Resource Template
  # ============================================================================
  resourceTemplate:
    path: "/etc/adapter/job-template.yaml"
